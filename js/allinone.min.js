!function(q,m){"function"==typeof define&&define.amd?define(m):"object"==typeof exports?module.exports=m():q.Blazy=m()}(this,function(){function q(b){var c=b._util;c.elements=function(b){for(var c=[],a=(b=b.root.querySelectorAll(b.selector)).length;a--;c.unshift(b[a]));return c}(b.options),c.count=c.elements.length,c.destroyed&&(c.destroyed=!1,b.options.container&&l(b.options.container,function(a){n(a,"scroll",c.validateT)}),n(window,"resize",c.saveViewportOffsetT),n(window,"resize",c.validateT),n(window,"scroll",c.validateT)),m(b)}function m(b){for(var c=b._util,a=0;a<c.count;a++){var e,d=c.elements[a],g=d;e=b.options;var p=g.getBoundingClientRect();e.container&&y&&(g=g.closest(e.containerClass))?e=!!r(g=g.getBoundingClientRect(),f)&&r(p,{top:g.top-e.offset,right:g.right+e.offset,bottom:g.bottom+e.offset,left:g.left-e.offset}):e=r(p,f),(e||t(d,b.options.successClass))&&(b.load(d),c.elements.splice(a,1),c.count--,a--)}0===c.count&&b.destroy()}function r(b,c){return b.right>=c.left&&b.bottom>=c.top&&b.left<=c.right&&b.top<=c.bottom}function z(b,c,a){if(!t(b,a.successClass)&&(c||a.loadInvisible||0<b.offsetWidth&&0<b.offsetHeight))if(c=b.getAttribute(u)||b.getAttribute(a.src)){var d=(c=c.split(a.separator))[A&&1<c.length?1:0],e=b.getAttribute(a.srcset),g="img"===b.nodeName.toLowerCase(),p=(c=b.parentNode)&&"picture"===c.nodeName.toLowerCase();if(g||void 0===b.src){var h=new Image,w=function(){a.error&&a.error(b,"invalid"),v(b,a.errorClass),k(h,"error",w),k(h,"load",f)},f=function(){g?p||B(b,d,e):b.style.backgroundImage='url("'+d+'")',x(b,a),k(h,"load",f),k(h,"error",w)};p&&(h=b,l(c.getElementsByTagName("source"),function(b){var c=a.srcset,e=b.getAttribute(c);e&&(b.setAttribute("srcset",e),b.removeAttribute(c))})),n(h,"error",w),n(h,"load",f),B(h,d,e)}else b.src=d,x(b,a)}else"video"===b.nodeName.toLowerCase()?(l(b.getElementsByTagName("source"),function(b){var c=a.src,e=b.getAttribute(c);e&&(b.setAttribute("src",e),b.removeAttribute(c))}),b.load(),x(b,a)):(a.error&&a.error(b,"missing"),v(b,a.errorClass))}function x(b,c){v(b,c.successClass),c.success&&c.success(b),b.removeAttribute(c.src),b.removeAttribute(c.srcset),l(c.breakpoints,function(a){b.removeAttribute(a.src)})}function B(b,c,a){a&&b.setAttribute("srcset",a),b.src=c}function t(b,c){return-1!==(" "+b.className+" ").indexOf(" "+c+" ")}function v(b,c){t(b,c)||(b.className+=" "+c)}function C(b){f.bottom=(window.innerHeight||document.documentElement.clientHeight)+b,f.right=(window.innerWidth||document.documentElement.clientWidth)+b}function n(b,c,a){b.attachEvent?b.attachEvent&&b.attachEvent("on"+c,a):b.addEventListener(c,a,{capture:!1,passive:!0})}function k(b,c,a){b.detachEvent?b.detachEvent&&b.detachEvent("on"+c,a):b.removeEventListener(c,a,{capture:!1,passive:!0})}function l(b,c){if(b&&c)for(var a=b.length,d=0;d<a&&!1!==c(b[d],d);d++);}function D(b,c,a){var d=0;return function(){var e=+new Date;e-d<c||(d=e,b.apply(a,arguments))}}var u,f,A,y;return function(b){if(!document.querySelectorAll){var c=document.createStyleSheet();document.querySelectorAll=function(a,b,d,h,f){for(f=document.all,b=[],d=(a=a.replace(/\[for\b/gi,"[htmlFor").split(",")).length;d--;){for(c.addRule(a[d],"k:v"),h=f.length;h--;)f[h].currentStyle.k&&b.push(f[h]);c.removeRule(0)}return b}}var a=this,d=a._util={};d.elements=[],d.destroyed=!0,a.options=b||{},a.options.error=a.options.error||!1,a.options.offset=a.options.offset||100,a.options.root=a.options.root||document,a.options.success=a.options.success||!1,a.options.selector=a.options.selector||".b-lazy",a.options.separator=a.options.separator||"|",a.options.containerClass=a.options.container,a.options.container=!!a.options.containerClass&&document.querySelectorAll(a.options.containerClass),a.options.errorClass=a.options.errorClass||"b-error",a.options.breakpoints=a.options.breakpoints||!1,a.options.loadInvisible=a.options.loadInvisible||!1,a.options.successClass=a.options.successClass||"b-loaded",a.options.validateDelay=a.options.validateDelay||25,a.options.saveViewportOffsetDelay=a.options.saveViewportOffsetDelay||50,a.options.srcset=a.options.srcset||"data-srcset",a.options.src=u=a.options.src||"data-src",y=Element.prototype.closest,A=1<window.devicePixelRatio,(f={}).top=0-a.options.offset,f.left=0-a.options.offset,a.revalidate=function(){q(a)},a.load=function(a,b){var c=this.options;void 0===a.length?z(a,b,c):l(a,function(a){z(a,b,c)})},a.destroy=function(){var a=this._util;this.options.container&&l(this.options.container,function(b){k(b,"scroll",a.validateT)}),k(window,"scroll",a.validateT),k(window,"resize",a.validateT),k(window,"resize",a.saveViewportOffsetT),a.count=0,a.elements.length=0,a.destroyed=!0},d.validateT=D(function(){m(a)},a.options.validateDelay,a),d.saveViewportOffsetT=D(function(){C(a.options.offset)},a.options.saveViewportOffsetDelay,a),C(a.options.offset),l(a.options.breakpoints,function(a){if(a.width>=window.screen.width)return u=a.src,!1}),setTimeout(function(){q(a)})}}),function(root,factory){"function"==typeof define&&define.amd?define([],function(){return factory(root)}):"object"==typeof exports?module.exports=factory(root):root.SmoothScroll=factory(root)}("undefined"!=typeof global?global:"undefined"!=typeof window?window:this,function(window){"use strict";var defaults={ignore:"[data-scroll-ignore]",header:null,topOnEmptyHash:!0,speed:500,speedAsDuration:!1,durationMax:null,durationMin:null,clip:!0,offset:0,easing:"easeInOutCubic",customEasing:null,updateURL:!0,popstate:!0,emitEvents:!0},extend=function(){var merged={};return Array.prototype.forEach.call(arguments,function(obj){for(var key in obj){if(!obj.hasOwnProperty(key))return;merged[key]=obj[key]}}),merged},decode=function(hash){var decoded;try{decoded=decodeURIComponent(hash)}catch(e){decoded=hash}return decoded},escapeCharacters=function(id){"#"===id.charAt(0)&&(id=id.substr(1));for(var codeUnit,hash,string=String(id),length=string.length,index=-1,result="",firstCodeUnit=string.charCodeAt(0);++index<length;){if(0===(codeUnit=string.charCodeAt(index)))throw new InvalidCharacterError("Invalid character: the input contains U+0000.");1<=codeUnit&&codeUnit<=31||127==codeUnit||0===index&&48<=codeUnit&&codeUnit<=57||1===index&&48<=codeUnit&&codeUnit<=57&&45===firstCodeUnit?result+="\\"+codeUnit.toString(16)+" ":result+=128<=codeUnit||45===codeUnit||95===codeUnit||48<=codeUnit&&codeUnit<=57||65<=codeUnit&&codeUnit<=90||97<=codeUnit&&codeUnit<=122?string.charAt(index):"\\"+string.charAt(index)}try{hash=decodeURIComponent("#"+result)}catch(e){hash="#"+result}return hash},getDocumentHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},getHeaderHeight=function(header){return header?function(elem){return parseInt(window.getComputedStyle(elem).height,10)}(header)+header.offsetTop:0},emitEvent=function(type,options,anchor,toggle){if(options.emitEvents&&"function"==typeof window.CustomEvent){var event=new CustomEvent(type,{bubbles:!0,detail:{anchor:anchor,toggle:toggle}});document.dispatchEvent(event)}};return function(selector,options){var settings,toggle,fixedHeader,animationInterval,smoothScroll={};smoothScroll.cancelScroll=function(noEvent){cancelAnimationFrame(animationInterval),animationInterval=null,noEvent||emitEvent("scrollCancel",settings)},smoothScroll.animateScroll=function(anchor,toggle,options){var _settings=extend(settings||defaults,options||{}),isNum="[object Number]"===Object.prototype.toString.call(anchor),anchorElem=isNum||!anchor.tagName?null:anchor;if(isNum||anchorElem){var startLocation=window.pageYOffset;_settings.header&&!fixedHeader&&(fixedHeader=document.querySelector(_settings.header));var start,percentage,position,headerHeight=getHeaderHeight(fixedHeader),endLocation=isNum?anchor:function(anchor,headerHeight,offset,clip){var location=0;if(anchor.offsetParent)for(;location+=anchor.offsetTop,anchor=anchor.offsetParent;);return location=Math.max(location-headerHeight-offset,0),clip&&(location=Math.min(location,getDocumentHeight()-window.innerHeight)),location}(anchorElem,headerHeight,parseInt("function"==typeof _settings.offset?_settings.offset(anchor,toggle):_settings.offset,10),_settings.clip),distance=endLocation-startLocation,documentHeight=getDocumentHeight(),timeLapsed=0,speed=function(distance,settings){var speed=settings.speedAsDuration?settings.speed:Math.abs(distance/1e3*settings.speed);return settings.durationMax&&speed>settings.durationMax?settings.durationMax:settings.durationMin&&speed<settings.durationMin?settings.durationMin:speed}(distance,_settings),stopAnimateScroll=function(position,endLocation){var currentLocation=window.pageYOffset;if(position==endLocation||currentLocation==endLocation||(startLocation<endLocation&&window.innerHeight+currentLocation)>=documentHeight)return smoothScroll.cancelScroll(!0),function(anchor,endLocation,isNum){0===anchor&&document.body.focus(),isNum||(anchor.focus(),document.activeElement!==anchor&&(anchor.setAttribute("tabindex","-1"),anchor.focus(),anchor.style.outline="none"),window.scrollTo(0,endLocation))}(anchor,endLocation,isNum),emitEvent("scrollStop",_settings,anchor,toggle),!(animationInterval=start=null)},loopAnimateScroll=function(timestamp){start||(start=timestamp),percentage=(timeLapsed+=timestamp-start)/parseInt(speed,10),position=startLocation+distance*function(settings,time){var pattern;return"easeInQuad"===settings.easing&&(pattern=time*time),"easeOutQuad"===settings.easing&&(pattern=time*(2-time)),"easeInOutQuad"===settings.easing&&(pattern=time<.5?2*time*time:(4-2*time)*time-1),"easeInCubic"===settings.easing&&(pattern=time*time*time),"easeOutCubic"===settings.easing&&(pattern=--time*time*time+1),"easeInOutCubic"===settings.easing&&(pattern=time<.5?4*time*time*time:(time-1)*(2*time-2)*(2*time-2)+1),"easeInQuart"===settings.easing&&(pattern=time*time*time*time),"easeOutQuart"===settings.easing&&(pattern=1- --time*time*time*time),"easeInOutQuart"===settings.easing&&(pattern=time<.5?8*time*time*time*time:1-8*--time*time*time*time),"easeInQuint"===settings.easing&&(pattern=time*time*time*time*time),"easeOutQuint"===settings.easing&&(pattern=1+--time*time*time*time*time),"easeInOutQuint"===settings.easing&&(pattern=time<.5?16*time*time*time*time*time:1+16*--time*time*time*time*time),settings.customEasing&&(pattern=settings.customEasing(time)),pattern||time}(_settings,percentage=1<percentage?1:percentage),window.scrollTo(0,Math.floor(position)),stopAnimateScroll(position,endLocation)||(animationInterval=window.requestAnimationFrame(loopAnimateScroll),start=timestamp)};0===window.pageYOffset&&window.scrollTo(0,0),function(anchor,isNum,options){isNum||history.pushState&&options.updateURL&&history.pushState({smoothScroll:JSON.stringify(options),anchor:anchor.id},document.title,anchor===document.documentElement?"#top":"#"+anchor.id)}(anchor,isNum,_settings),emitEvent("scrollStart",_settings,anchor,toggle),smoothScroll.cancelScroll(!0),window.requestAnimationFrame(loopAnimateScroll)}};var clickHandler=function(event){if(!("matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches)&&0===event.button&&!event.metaKey&&!event.ctrlKey&&"closest"in event.target&&(toggle=event.target.closest(selector))&&"a"===toggle.tagName.toLowerCase()&&!event.target.closest(settings.ignore)&&toggle.hostname===window.location.hostname&&toggle.pathname===window.location.pathname&&/#/.test(toggle.href)){var hash=escapeCharacters(decode(toggle.hash)),anchor=settings.topOnEmptyHash&&"#"===hash?document.documentElement:document.querySelector(hash);(anchor=anchor||"#top"!==hash?anchor:document.documentElement)&&(event.preventDefault(),function(options){if(history.replaceState&&options.updateURL&&!history.state){var hash=window.location.hash;hash=hash||window.pageYOffset,history.replaceState({smoothScroll:JSON.stringify(options),anchor:hash||window.pageYOffset},document.title,hash||window.location.href)}}(settings),smoothScroll.animateScroll(anchor,toggle))}},popstateHandler=function(event){if(null!==history.state&&history.state.smoothScroll&&history.state.smoothScroll===JSON.stringify(settings)){var anchor=history.state.anchor;anchor&&0!==anchor&&!(anchor=document.querySelector(escapeCharacters(decode(history.state.anchor))))||smoothScroll.animateScroll(anchor,null,{updateURL:!1})}};return smoothScroll.destroy=function(){settings&&(document.removeEventListener("click",clickHandler,!1),window.removeEventListener("popstate",popstateHandler,!1),smoothScroll.cancelScroll(),animationInterval=fixedHeader=toggle=settings=null)},smoothScroll.init=function(options){if(!("querySelector"in document&&"addEventListener"in window&&"requestAnimationFrame"in window&&"closest"in window.Element.prototype))throw"Smooth Scroll: This browser does not support the required JavaScript methods and browser APIs.";smoothScroll.destroy(),settings=extend(defaults,options||{}),fixedHeader=settings.header?document.querySelector(settings.header):null,document.addEventListener("click",clickHandler,!1),settings.updateURL&&settings.popstate&&window.addEventListener("popstate",popstateHandler,!1)},smoothScroll.init(options),smoothScroll}});var scroll=new SmoothScroll(".toc-btn, .toc-link",{speed:1e3,easing:"easeInOutCubic",speedAsDuration:!0,clip:!0,updateURL:!0,popstate:!0}),postProgressBar=function(){var progressBar=document.querySelector("progress"),header=document.querySelector(".floating-header"),title=document.querySelector(".post-full-title"),lastScrollY=window.scrollY,lastWindowHeight=window.innerHeight,ticking=!1;function update(){var trigger=title.getBoundingClientRect().top+window.scrollY,triggerOffset=title.offsetHeight+35,progressMax=document.body.offsetHeight-lastWindowHeight;trigger+triggerOffset<=lastScrollY?header.classList.add("floating-active"):header.classList.remove("floating-active"),progressBar.setAttribute("max",progressMax),progressBar.setAttribute("value",lastScrollY),ticking=!1}window.addEventListener("scroll",function(){lastScrollY=window.scrollY,ticking||requestAnimationFrame(update),ticking=!0},{passive:!0}),update()};if(document.querySelector(".toc-bar")){var tocBar=document.querySelector(".toc-bar "),tocOpen=document.querySelector(".toc-open"),tocClose=document.querySelector(".toc-close"),tocSwitch=document.querySelector(".toc-switch"),tocMain=document.querySelector(".toc-main"),tocWidth=window.getComputedStyle(tocMain).width.replace("px","");"768"<=window.screen.width&&(tocBar.style.right=-tocWidth+"px"),tocSwitch.addEventListener("click",function(){window.requestAnimationFrame(function(){tocOpen.classList.contains("hide")?("768"<=window.screen.width?tocBar.style.right=-tocWidth+"px":tocBar.style.top="100%",tocClose.classList.add("hide"),tocOpen.classList.remove("hide")):("768"<=window.screen.width?tocBar.style.right=0:tocBar.style.top=0,tocOpen.classList.add("hide"),tocClose.classList.remove("hide"))})});var tocItem=document.querySelectorAll(".toc-link");tocItem.forEach(function(toc){toc.addEventListener("click",function(){window.requestAnimationFrame(function(){window.screen.width<"768"&&(tocBar.style.top="100%",tocClose.classList.add("hide"),tocOpen.classList.remove("hide"))})})})}var keepSearchData=function(siteRoot){fetch(siteRoot+"searchData.json").then(function(response){return response.json()}).then(function(resData){localStorage.setItem("searchData",JSON.stringify(resData))})},checkAndGetData=function(siteRoot){fetch(siteRoot+"searchVersion.txt?t="+ +new Date).then(function(response){return response.text()}).then(function(resVersion){localStorage.getItem("searchVersion")!==resVersion&&(localStorage.setItem("searchVersion",resVersion),keepSearchData(siteRoot))})},searchFunc=function(siteRoot){checkAndGetData(siteRoot);var localSearchData=localStorage.getItem("searchData"),datas=JSON.parse(localSearchData),input=document.getElementById("local-search-input");if(input){var resultContent=document.getElementById("local-search-result");input.addEventListener("input",function(){"string"!=typeof localSearchData&&(localSearchData=localStorage.getItem("searchData"),datas=JSON.parse(localSearchData)),printRs(this,datas,resultContent)})}},searchFuncSW=function(siteRoot){fetch(siteRoot+"searchData.json").then(function(response){return response.json()}).then(function(resData){var localSearchData=JSON.stringify(resData),datas=JSON.parse(localSearchData),input=document.getElementById("local-search-input");if(input){var resultContent=document.getElementById("local-search-result");input.addEventListener("input",function(){printRs(this,datas,resultContent)})}})},printRs=function(input,datas,resultContent){var str='<ul class="search-result-list">',keywords=input.value.trim().toLowerCase().split(/[\s\-]+/);resultContent.innerHTML="",input.value.trim().length<=0||(datas.forEach(function(data){var isMatch=!0;data.title&&""!==data.title.trim()||(data.title="Untitled");var data_title=data.title.trim().toLowerCase(),data_content=data.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),data_url=data.url,index_title=-1,index_content=-1,first_occur=-1;if(""!==data_content?keywords.forEach(function(keyword,i){index_title=data_title.indexOf(keyword),index_content=data_content.indexOf(keyword),index_title<0&&index_content<0?isMatch=!1:(index_content<0&&(index_content=0),0==i&&(first_occur=index_content))}):isMatch=!1,isMatch){str+="<li><a href='"+data_url+"' class='search-result-title'>"+data_title+"</a>";var content=data.content.trim().replace(/<[^>]+>/g,"");if(0<=first_occur){var start=first_occur-20,end=first_occur+80;start<0&&(start=0),0==start&&(end=100),end>content.length&&(end=content.length);var match_content=content.substr(start,end);keywords.forEach(function(keyword){var regS=new RegExp(keyword,"gi");match_content=match_content.replace(regS,'<em class="search-keyword">'+keyword+"</em>")}),str+='<p class="search-result">'+match_content+"...</p>"}str+="</li>"}}),str+="</ul>",resultContent.innerHTML=str)};